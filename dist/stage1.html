<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Stage 1</title>
  <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
  <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
  <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
  <script src="bundle.js"></script>
</head>

<body>
  <a-scene stats 
  inspector-plugin-recast
  gltf-model="navmesh.gltf">

    <!-- assets  -->
    <a-assets>
             <!-- navmesh -->
             <!-- <a-asset-item id="navmesh-spawn" src="assets/navmesh_spawn_zone.gltf"></a-asset-item> -->
      <!-- img  -->
      <img id="floor" src="assets/textures/treadplate1.png"></img>
      <img id="wall" src="assets/textures/wall2.jpg"></img>
      <img id="danger" src="assets/textures/danger.png"></img>
      <img id="title" src="assets/textures/titre.png"></img>

    <!-- sounds  -->
      <a-asset-item id="pick_sound" response-type="arraybuffer" src="assets/audio/pick.wav" preload="auto"></a-asset-item>
      <a-asset-item id="screwfall_sound" response-type="arraybuffer" src="assets/audio/screwfall.mp3" preload="auto"></a-asset-item>
      <a-asset-item id="radio_sound" response-type="arraybuffer" src="assets/audio/radio.mp3" preload="auto"></a-asset-item>
      <a-asset-item id="door_lock_sound" response-type="arraybuffer" src="assets/audio/door_lock.wav" preload="auto"></a-asset-item>

      <!-- objects  -->
      <a-asset-item id="red_button" src="assets/3d_objects/red_button/scene.gltf"></a-asset-item>
      <a-asset-item id="light" src="assets/3d_objects/light/scene.gltf"></a-asset-item>
      <a-asset-item id="radio" src="assets/3d_objects/prc_152/scene.gltf"></a-asset-item>
      <a-asset-item id="electronic_panel" src="assets/3d_objects/control_panel/scene.gltf"></a-asset-item>
      <a-asset-item id="table" src="assets/3d_objects/table/scene.gltf"></a-asset-item>
      <a-asset-item id="screwdriver" src="assets/3d_objects/screwdriver/scene.gltf"></a-asset-item>
      <a-asset-item id="pipes" src="assets/3d_objects/pipes/scene.gltf"></a-asset-item>
      <a-asset-item id="door" src="assets/3d_objects/door/scene.gltf"></a-asset-item>
      <a-asset-item id="exit" src="assets/3d_objects/exit/scene.gltf"></a-asset-item>
      <a-asset-item id="screw" src="assets/3d_objects/screw/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- structure de l'Ã©tage  -->
    <a-plane position="-0.8 0.2 0.2" rotation="-90 0 0" color="red" height="2" width="2"></a-plane>
    <a-plane rotation="-90 0 0" material="shader: flat; src: #floor; repeat: 4 4 ; " height="3" width="3"></a-plane>
    <a-plane position="-1.5 1.5 0" rotation="0 90 0" material="shader: flat; src: #wall ; " height="3" width="3"> </a-plane>
    <a-plane position="+1.5 1.5 0" rotation="0 90 0" material="shader: flat; src: #wall; side:double; " height="3" width="3"></a-plane>
    <a-plane position="0 1.5 -1.5" rotation="0 0 90" material="shader: flat; src: #wall  ;side:double " height="3"  width="3"></a-plane>
    <a-plane position="0 1.5 1.5" rotation="0 0 90" material="shader: flat; src: #wall ;side:double " height="3" width="3"></a-plane>
    <a-plane position="0 3 0" rotation="90 0 0" material="shader: flat; src: #wall ;side:double " height="3" width="3"></a-plane>
    <a-plane position="0 3 0" rotation="90 0 0" material="shader: flat; src: #wall ;side:double " height="3" width="3"></a-plane>

    <!--objets  -->
    <a-plane 
    position="-1.49 1.5 0" 
    rotation="0 90 0" 
    material="shader: flat; src: #danger ; " 
    height="0.55"
    width="0.4"
    listen-to__1="target: #screw1; event: click; emit: open1"
    listen-to__2="target: #screw2; event: click; emit: open2"
    listen-to__3="target: #screw3; event: click; emit: open3"
    listen-to__4="target: #screw4; event: click; emit: open4"
    animation__open="property: rotation; to: -1.49 0.2 0 ; dur: 10; startEvents: open1&open2&open3&open4"
    ></a-plane>

    
    <!-- <a-entity hover-highlighter gltf-model="#red_button" position="-1.5 1.5 0.2" scale="0.1, 0.1, 0.1"></a-entity> -->
    <a-entity  gltf-model="#light" position="0 3 0" scale="0.01, 0.01, 0.01" rotation="90 0 0"></a-entity>
    <a-entity  gltf-model="#electronic_panel" position="0.6 0.3 0" scale="0.008, 0.008, 0.008"></a-entity>
    <a-entity 
    hover-highlighter 
    gltf-model="#radio" 
    position="-0.9 0.9 -1.3" 
    scale="0.0008, 0.0008, 0.0008"  
    rotation="0  45 0"
    > <a-musicplayer music="#radio_sound"></a-musicplayer>
  </a-entity>

    <a-entity gltf-model="#table" position="-0.9 0.3 -1.2" scale="0.4, 0.4, 0.4" rotation="0 90 0"></a-entity>

    <a-entity 
    hover-highlighter
    grabbable="target: #right-hand"
    gltf-model="#screwdriver" 
    position="-1 0.45 -1.0" scale="0.02, 0.02, 0.02"
    rotation="0 -90 0"
    sound="src: #pick_sound; on: click"
    >  </a-entity>


    <a-entity 
    id="screw1"
    hover-highlighter 
    gltf-model="#screw" 
    position="-1.55 1.77 0.185" 
    scale="0.001, 0.001, 0.001"
    rotation="90 0 -90"
    sound="src: #screwfall_sound; on: click"
    animation="property: position; to: -1.4 0.2 0.185;dur: 10; startEvents: click"
    ></a-entity>
    <a-entity 
    id="screw2"
    hover-highlighter 
    gltf-model="#screw" 
    position="-1.55 1.77 -0.2" 
    scale="0.001, 0.001, 0.001"
    rotation="90 0 -90"
    sound="src: #screwfall_sound; on: click"
    animation="property: position; to: -1.45 0.2 -0.2;dur: 10; startEvents: click"
    ></a-entity>
    <a-entity 
    id="screw3"
    hover-highlighter 
    gltf-model="#screw" 
    position="-1.55 1.22 0.185" 
    scale="0.001, 0.001, 0.001"
    rotation="90 0 -90"
    sound="src: #screwfall_sound; on: click"
    animation="property: position; to: -1.35 0.2 0.170; dur: 10; startEvents: click"
    ></a-entity>
    <a-entity
    id="screw4"
    hover-highlighter 
    gltf-model="#screw" 
    position="-1.55 1.22 -0.2" 
    scale="0.001, 0.001, 0.001" 
    rotation="90 0 -90"
    sound="src: #screwfall_sound; on: click"
    animation="property: position; to: -1.3 0.2 -0.2;dur: 10; startEvents: click"
    ></a-entity>




    <a-entity gltf-model="#pipes" position="-1.2 2.5 -1.1" scale="0.8, 0.5, 0.8" rotation="180 -90 0"> </a-entity>
    <a-entity hover-highlighter gltf-model="#door" position="-0.6 1.1 1.5" scale="0.15, 0.14, 0.15" rotation="0 180 0" sound="src: #door_lock_sound; on: click"></a-entity>
    <a-entity  gltf-model="#exit" position="-0.5 2.7 1.5" scale="0.04, 0.04, 0.04" rotation="0 180 0"></a-entity>

    <!-- bruits  -->
    <!-- <a-entity position="-0.5 2.7 1.5" rotation="0 180 0" sound="src: #sound-birds; autoplay: true; loop=true"> </a-entity> -->


    <!-- lumiÃ¨re  -->
    <a-entity light="type: ambient; color: #FFF; intensity: 4" ></a-entity>
    <a-entity light="type: point; color: #fbee98; intensity: 1; distance: 6; decay: 6" position="0 2.38 0"></a-entity>



    <a-entity navmesh-manager="navmesh: #nav-mesh-spawn"
    event-set__access-one="_event: accces-one; navmesh-manager.navmesh: #nav-mesh-spawn-main"
    listen-to__access-one="target: #switch-spawn; event: click; emit: accces-one; once: true"
    event-set__access-two="_event: accces-two; navmesh-manager.navmesh: #nav-mesh-full"
    listen-to__access-two="target: #drop-zone; event: received; emit: accces-two; once: true">
  </a-entity>


    <!-- avatar  -->
    <a-entity id="rig" disable-in-vr="component: movement-controls" movement-controls="constrainToNavMesh: true;"position="0 0 3">

      <a-entity id="head" position="0 1.7 0" camera look-controls="pointerLockEnabled: true"> <!--hauteur de la personne -->
        <a-entity 
        id="eyes" 
        geometry="primitive: circle; radius: 0.0005" 
        material="color: black" position="0 0 -0.1"
        cursor disable-in-vr="component: geometry" 
        disable-in-vr__cursor="component: cursor"
        raycaster="objects: [hover-highlighter]; far: 1.5">
        </a-entity>
      </a-entity>

      <a-entity 
      id="hands" 
      position="0 0.9 0" 
      bind-rotation="target: #head" 
      disable-in-vr="component: bind-rotation"
      disable-in-vr__pos="component: position">
        <a-entity 
        id="left-hand" 
        position="-0.3 0 -0.3" 
        rotation="0 0 90" 
        bind-rotation="target: #head"
        disable-in-vr="component: bind-rotation" 
        hand-controls="hand: left"
        teleport-controls="cameraRig: #rig; collisionEntities: #nav-mesh-spawn; button: trigger; curveShootingSpeed: 8">
        </a-entity>
        <a-entity 
        id="right-hand" 
        position="0.3 0 -0.3" 
        rotation="0 0 -90" 
        bind-rotation="target: #head"
        disable-in-vr="component: bind-rotation" 
        hand-controls="hand: right" 
        laser-controls="hand: right"
        raycaster="far: 1.5; objects: [hover-highlighter]; showLine: true">
        </a-entity>
      </a-entity>
    </a-entity>
  </a-scene>

</body>

</html>