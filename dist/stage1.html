<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Stage 1</title>
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
    <script src="bundle.js"></script>
  </head>
  <body>
    <a-scene stats >
       <!-- chargements  --> 
        <a-assets>
          <img id="floor" src="assets/textures/treadplate1.png" ></img>
          <img id="wall" src="assets/textures/wall.jpg" ></img>

            <a-asset-item id="red_button" src="assets/3d_objects/red_button/scene.gltf"></a-asset-item>
          </a-assets>

  
          <!-- objects  --> 
          <a-entity
                    id="blue"
                    hover-highlighter
                    geometry="primitive: box; depth: 1; height:1; width:1;"
                    material="color: red; metalness:0.5;"
                    position="0 0 0">
          </a-entity>

          <a-entity
                    id="red"
                    hover-highlighter
                    geometry="primitive: box; depth: 1; height:1; width:1;"
                    material="color: blue; metalness:0.5;"
                    position="0 1 0">
          </a-entity>

          <a-entity
                    id="purple"
                    geometry="primitive: box; depth: 1; height:1; width:1;"
                    material="color: purple; metalness:0.5;"
                    position="1 0 0"
                    listen-to__blue="target: #blue; event: click; emit: blueClicked; once: true"
                    listen-to__red="target: #red; event: click; emit: redClicked; once: true"
                    double-condition="cond1: blueClicked; cond2: redClicked; result: purpleOK"
                    animation="property: material.color; to: #00ff00; delay:1000; dur: 2000; startEvents: purpleOK">
          </a-entity>



          <!-- avatar  --> 
        <a-entity id="rig"
        disable-in-vr="component: movement-controls"
        movement-controls="constrainToNavMesh: true;"
        position="0 0 3"
      >

        <a-entity id="head" position="0 1.7 0" camera look-controls="pointerLockEnabled: true">
          <a-entity
            id="eyes"
            geometry="primitive: circle; radius: 0.0005"
            material="color: black"
            position="0 0 -0.1"
            cursor
            disable-in-vr="component: geometry"
            disable-in-vr__cursor="component: cursor"
            raycaster="objects: [hover-highlighter]; far: 1.5"
          ></a-entity>
        </a-entity>

        <a-entity id="hands" position="0 0.9 0" bind-rotation="target: #head" disable-in-vr="component: bind-rotation" disable-in-vr__pos="component: position">
          <a-entity id="left-hand"
            position="-0.3 0 -0.3"
            rotation="0 0 90"
            bind-rotation="target: #head"
            disable-in-vr="component: bind-rotation"
            hand-controls="hand: left"
            teleport-controls="cameraRig: #rig; collisionEntities: #nav-mesh-spawn; button: trigger; curveShootingSpeed: 8"
          ></a-entity>
          <a-entity id="right-hand"
            position="0.3 0 -0.3"
            rotation="0 0 -90"
            bind-rotation="target: #head"
            disable-in-vr="component: bind-rotation"
            hand-controls="hand: right"
            laser-controls="hand: right"
            raycaster="far: 1.5; objects: [hover-highlighter]; showLine: true"
          ></a-entity>
        </a-entity>

      </a-entity>
      </a-scene>

  </body>
</html>